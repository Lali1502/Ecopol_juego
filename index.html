<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUE: El Misterio del Equilibrio Roto (RETO FINAL)</title>
    <style>
        /* ESTILOS GLOBALES */
        body {
            font-family: 'Georgia', serif;
            background-color: #0d1a26; /* Fondo oscuro, como la noche */
            color: #f4f4f9;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            background: #1c2b38; /* Fondo un poco m√°s claro para el contenido del juego */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
            min-height: 500px;
        }
        h1, h2, h3 {
            color: #ffcc00; /* Dorado viejo para el misterio */
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }
        
        /* ESTILOS DE LA P√ÅGINA DE INICIO (MANSI√ìN) */
        .inicio-historia {
            text-align: center;
            padding: 50px 20px;
            /* Nota: Si quieres cambiar la imagen, reemplaza la URL a continuaci√≥n. 
               Esta es una imagen de stock de una mansi√≥n misteriosa */
            background-image: url('https://i.imgur.com/f3Gj0t2.png'); 
            background-size: cover;
            background-position: center;
            color: white;
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            text-shadow: 1px 1px 5px #000;
        }
        .inicio-historia h1 {
            border-bottom: none;
            font-size: 2.8em;
            color: #ffd700; /* Dorado */
            margin-bottom: 5px;
        }
        .inicio-historia p {
            background-color: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente para leer mejor */
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        /* ESTILOS DEL JUEGO */
        .status, .pregunta {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .status {
            background-color: #3f51b5; /* Azul oscuro */
            border: 1px solid #7986cb;
            color: white;
        }
        .pregunta {
            background-color: #5c6bc0; /* Azul medio */
            border: 1px solid #9fa8da;
            color: white;
        }
        .error {
            background-color: #b71c1c; /* Rojo oscuro */
            border: 1px solid #ef5350;
            color: white;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            background-color: #ffd700; /* Botones dorados/amarillos */
            color: #333;
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #ffc107;
            transform: scale(1.05);
        }
        button.comodin {
            background-color: #00796b; /* Verde oscuro */
            color: white;
        }
        button.comodin:hover {
            background-color: #004d40;
        }
        #output {
            margin-top: 30px;
            padding: 20px;
            background-color: #263238; /* Gris oscuro para el output */
            border-radius: 5px;
            white-space: pre-wrap;
            color: #eceff1;
        }
        #output div {
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="status"></div>
        <div id="game-area"></div>
        <div id="output"></div>
    </div>

    <script>
        // --- 1. ESTADO GLOBAL DEL JUEGO ---
        let comodinesUsados = {
            smith: false, 
            keynes: false, 
            friedman: false 
        };
        let comodinesMapa = {
            'smith': 'Adam Smith (Micro)',
            'keynes': 'J.M. Keynes (Fiscal)',
            'friedman': 'M. Friedman (Monetaria)'
        };
        
        let pistasCrimen = {}; 
        let castigoActual = null;
        let preguntasCrimenRespondidas = 0;
        let castigosUsados = []; 
        let pistaIndex = 0; 
        
        const sospechosos = {
            A: 'Dr. Joseph A. Schumpeter (Desenvolvimiento)',
            B: 'Profesor Allyn A. Young (Rendimientos)'
        };

        // --- 2. CONTENIDO DEL JUEGO (Mismo contenido, alta complejidad) ---
        const preguntasCrimen = [
            // P1-P4: Pistas principales (Asesino, Arma, Lugar, M√≥vil)
            { id: 'P1', tipo: 'Asesino', pregunta: "Se encontr√≥ un texto de la v√≠ctima donde ridiculizaba la idea de que el crecimiento es un proceso de **desequilibrio cr√≥nico** y acumulativo. ¬øA qui√©n incrimina este m√≥vil ideol√≥gico?", opciones: { 'A': sospechosos.A, 'B': sospechosos.B }, respuestaCorrecta: 'B', clave: 'ASESINO', valor: 'Profesor Allyn A. Young' },
            { id: 'P2', tipo: 'Arma', pregunta: "El arma del crimen fue usada para eliminar la **corriente circular** del estado de reposo, forzando un cambio cualitativo. ¬øQu√© concepto representa el arma?", opciones: { 'A': 'La Innovaci√≥n (Destrucci√≥n Creadora)', 'B': 'La Divisi√≥n del Trabajo (Especializaci√≥n)' }, respuestaCorrecta: 'A', clave: 'ARMA', valor: 'Innovaci√≥n (Destrucci√≥n Creadora)' },
            { id: 'P3', tipo: 'Lugar', pregunta: "El crimen ocurri√≥ en el lugar donde los rendimientos decrecientes actuaban como **el principal obst√°culo** al crecimiento. ¬øQu√© elemento limitaba la acci√≥n del asesino seg√∫n su propia teor√≠a?", opciones: { 'A': 'El escaso pool de capital disponible.', 'B': 'La inelasticidad relativa de la demanda.' }, respuestaCorrecta: 'B', clave: 'LUGAR', valor: 'Sala de la Inelasticidad Relativa' },
            { id: 'P4', tipo: 'M√≥vil', pregunta: "La v√≠ctima fue encontrada con una nota que citaba a Marshall: 'El crecimiento viene de fuera'. ¬øQu√© te√≥rico fue el m√≥vil principal del crimen al afirmar que el crecimiento viene **de dentro**?", opciones: { 'A': sospechosos.A, 'B': sospechosos.B }, respuestaCorrecta: 'A', clave: 'M√ìVIL', valor: 'La Endogeneidad del Desarrollo (Schumpeter)' },
            
            // P5-P20: Pistas de refuerzo y coartadas complejas
            { id: 'P5', tipo: 'Coartada', pregunta: "El Dr. Schumpeter aleg√≥ que estaba **financiando un nuevo proyecto** con cr√©dito bancario. ¬øEs esto una coartada s√≥lida o un indicio de su involucramiento seg√∫n su propia teor√≠a?", opciones: { 'A': 'Indicio (La innovaci√≥n requiere cr√©dito bancario).', 'B': 'Coartada (Estaba ocupado con el capital propio).' }, respuestaCorrecta: 'A', clave: 'PISTA 5 (Cr√©dito)', valor: 'Cr√©dito Bancario como Indicio' },
            { id: 'P6', tipo: 'Especializaci√≥n', pregunta: "Si el crimen fue perpetrado por Young, debi√≥ maximizar la **divisi√≥n del trabajo** en el acto. ¬øQu√© acci√≥n ilustra mejor la divisi√≥n del trabajo?", opciones: { 'A': 'La creaci√≥n de un nuevo producto para el crimen.', 'B': 'La externalizaci√≥n de la vigilancia a un tercero.' }, respuestaCorrecta: 'B', clave: 'PISTA 6 (Divisi√≥n)', valor: 'Externalizaci√≥n de tareas' },
            { id: 'P7', tipo: 'Equilibrio', pregunta: "El asesino dej√≥ un diagrama de curvas de indiferencia inclinadas. Seg√∫n Young, este hallazgo implica que el Dr. Equilibrio buscaba: ", opciones: { 'A': 'Rendimientos crecientes.', 'B': 'Sustituci√≥n de factores por el mismo costo.' }, respuestaCorrecta: 'B', clave: 'PISTA 7 (Isocostos)', valor: 'Sustituci√≥n en Isocostos' },
            { id: 'P8', tipo: 'Est√°tica', pregunta: "Schumpeter separa **crecimiento** de **desenvolvimiento**. ¬øQu√© fen√≥meno econ√≥mico representa el simple crecimiento que Schumpeter considera dentro de la 'est√°tica'?", opciones: { 'A': 'La innovaci√≥n tecnol√≥gica.', 'B': 'El aumento de la poblaci√≥n.' }, respuestaCorrecta: 'B', clave: 'PISTA 8 (Est√°tica)', valor: 'Aumento Demogr√°fico' },
            { id: 'P9', tipo: 'Demanda', pregunta: "Seg√∫n la nota (4) de Young, para que un avance sea ventajoso, debe **modificar favorablemente** la curvatura de las curvas de isocostos. ¬øQu√© implica esto?", opciones: { 'A': 'Solo un cambio en el precio de los factores.', 'B': 'Un cambio en las elasticidades relativas.' }, respuestaCorrecta: 'B', clave: 'PISTA 9 (Curvatura)', valor: 'Cambio en Elasticidades' },
            { id: 'P10', tipo: 'Tecnolog√≠a', pregunta: "Si Schumpeter fue el asesino, el crimen fue un acto de **Destrucci√≥n Creadora**. ¬øQu√© destruye este acto en el proceso?", opciones: { 'A': 'El capital de la competencia.', 'B': 'Las estructuras econ√≥micas obsoletas.' }, respuestaCorrecta: 'B', clave: 'PISTA 10 (Destrucci√≥n)', valor: 'Estructuras Obsoletas' },
            { id: 'P11', tipo: 'Retornos', pregunta: "Young sostiene que el progreso es el resultado de la evoluci√≥n del proceso productivo, ¬øpero cu√°l es la **causa del progreso** en su teor√≠a?", opciones: { 'A': 'La simple acumulaci√≥n de capital.', 'B': 'El progreso es la causa del progreso.' }, respuestaCorrecta: 'B', clave: 'PISTA 11 (Causa)', valor: 'Progreso Autocausado' },
            { id: 'P12', tipo: 'Monopolio', pregunta: "Schumpeter defend√≠a el **monopolio temporal** de la innovaci√≥n. El Dr. Equilibrio fue asesinado justo despu√©s de defender la competencia perfecta. ¬øQu√© justifica Schumpeter en el monopolio?", opciones: { 'A': 'Permite la distribuci√≥n justa de la renta.', 'B': 'Asegura las ganancias extraordinarias para innovar.' }, respuestaCorrecta: 'B', clave: 'PISTA 12 (Monopolio)', valor: 'Ganancias Extraordinarias' },
            { id: 'P13', tipo: 'Desequilibrio', pregunta: "Young enfatiza que el crecimiento es un proceso de **desequilibrio continuo** y no de ajustes a nuevos equilibrios. ¬øQu√© implica esto para el rol del mercado?", opciones: { 'A': 'El mercado siempre tiende a corregir fallos.', 'B': 'El mercado opera en un desajuste permanente.' }, respuestaCorrecta: 'B', clave: 'PISTA 13 (Mercado)', valor: 'Desajuste Permanente' },
            { id: 'P14', tipo: 'Empresario', pregunta: "El empresario schumpeteriano no es un administrador, sino un **h√©roe**. ¬øQu√© funci√≥n principal lo diferencia del simple capitalista?", opciones: { 'A': 'El manejo eficiente del capital.', 'B': 'La combinaci√≥n de factores de forma nueva.' }, respuestaCorrecta: 'B', clave: 'PISTA 14 (H√©roe)', valor: 'Nueva Combinaci√≥n de Factores' },
            { id: 'P15', tipo: 'Externalidades', pregunta: "El crimen involucr√≥ una **externalidad positiva** al sector de la vigilancia. Seg√∫n Young, este fen√≥meno es crucial para...", opciones: { 'A': 'Convertir rendimientos internos en rendimientos externos.', 'B': 'Estabilizar los ciclos econ√≥micos.' }, respuestaCorrecta: 'A', clave: 'PISTA 15 (Externalidad)', valor: 'Retornos de Escala Externos' },
            { id: 'P16', tipo: 'Ciclos', pregunta: "Schumpeter vincula el **ciclo econ√≥mico** a los *clusters* de innovaci√≥n. ¬øQu√© fase del ciclo es causada por la implementaci√≥n masiva de innovaciones?", opciones: { 'A': 'La depresi√≥n.', 'B': 'El auge.' }, respuestaCorrecta: 'B', clave: 'PISTA 16 (Ciclo)', valor: 'El Auge del Ciclo' },
            { id: 'P17', tipo: 'L√≠mite', pregunta: "Young cita a Smith: La divisi√≥n del trabajo es limitada por el tama√±o del mercado. ¬øQu√© factor **no** limita la divisi√≥n del trabajo seg√∫n Young?", opciones: { 'A': 'El potencial humano.', 'B': 'La magnitud de la demanda.' }, respuestaCorrecta: 'A', clave: 'PISTA 17 (L√≠mite)', valor: 'Potencial Humano (No Limitante)' },
            { id: 'P18', tipo: 'Dinero', pregunta: "El Dr. Equilibrio fue asfixiado con un billete que representaba el **dinero est√°tico**. ¬øQu√© representa el dinero din√°mico en Schumpeter?", opciones: { 'A': 'Un medio de cambio neutral.', 'B': 'Un veh√≠culo de transferencia de poder de compra (cr√©dito).' }, respuestaCorrecta: 'B', clave: 'PISTA 18 (Dinero)', valor: 'Cr√©dito Din√°mico' },
            { id: 'P19', tipo: 'Cambio', pregunta: "Seg√∫n Young, si -dy/dx aumenta en relaci√≥n con y/x en las curvas de indiferencia, la amplitud del movimiento en la direcci√≥n de P1 **se incrementa**. ¬øQu√© principio microecon√≥mico avanzado describe esta relaci√≥n?", opciones: { 'A': 'Elasticidad de sustituci√≥n.', 'B': 'Tasa marginal de sustituci√≥n decreciente.' }, respuestaCorrecta: 'A', clave: 'PISTA 19 (Isocostos II)', valor: 'Elasticidad de Sustituci√≥n' },
            { id: 'P20', tipo: 'Capitalismo', pregunta: "El Dr. Equilibrio era pesimista sobre el futuro del capitalismo. ¬øQu√© factor predijo Schumpeter que, ir√≥nicamente, **destruir√≠a** el capitalismo que √©l tanto defend√≠a?", opciones: { 'A': 'La sobreacumulaci√≥n de capital.', 'B': 'La racionalizaci√≥n de la innovaci√≥n.' }, respuestaCorrecta: 'B', clave: 'PISTA 20 (Final)', valor: 'Racionalizaci√≥n de la Innovaci√≥n' }
        ];

        const bancoCastigos = [
            // Microeconom√≠a (Smith/Young) - Comod√≠n: Smith
            { id: 'C1', tipo: 'Micro: Fallo de Mercado', pregunta: "En un mercado con externalidades positivas, ¬ød√≥nde se ubica el √≥ptimo social en relaci√≥n con el √≥ptimo privado?", opciones: { 'E1': 'A la izquierda (menor cantidad).', 'E2': 'A la derecha (mayor cantidad).', 'E3': 'Coinciden.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C2', tipo: 'Micro: Monopolio', pregunta: "Para un monopolista, ¬øc√≥mo se relaciona el Ingreso Marginal (IM) con el Precio (P)?", opciones: { 'E1': 'IM = P', 'E2': 'IM > P', 'E3': 'IM < P' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            { id: 'C3', tipo: 'Micro: Escala', pregunta: "Los rendimientos crecientes a escala se asocian a una Curva de Costo Total Promedio de Largo Plazo (CTP L/P):", opciones: { 'E1': 'Creciente.', 'E2': 'Decreciente.', 'E3': 'Constante.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C4', tipo: 'Micro: Curvas', pregunta: "¬øQu√© mide la pendiente de la Curva de Indiferencia?", opciones: { 'E1': 'La Relaci√≥n Marginal de Transformaci√≥n.', 'E2': 'La Tasa Marginal de Sustituci√≥n.', 'E3': 'El Precio Relativo.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C5', tipo: 'Micro: Bienes', pregunta: "Si la elasticidad ingreso de la demanda es negativa, el bien es considerado:", opciones: { 'E1': 'Normal.', 'E2': 'Superior.', 'E3': 'Inferior.' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            { id: 'C6', tipo: 'Micro: Competencia', pregunta: "¬øQu√© condici√≥n se cumple para una empresa en competencia perfecta a largo plazo?", opciones: { 'E1': 'Precio > CTP.', 'E2': 'Precio = CTP m√≠nimo.', 'E3': 'IM < CM.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C7', tipo: 'Micro: Riesgo', pregunta: "¬øQu√© teor√≠a explica c√≥mo la informaci√≥n asim√©trica lleva a que solo las peores opciones permanezcan en el mercado (como en los autos usados)?", opciones: { 'E1': 'Riesgo Moral.', 'E2': 'Selecci√≥n Adversa.', 'E3': 'Teorema de Coase.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C8', tipo: 'Micro: Elasticidad', pregunta: "Si la elasticidad cruzada es +0.5, los bienes son:", opciones: { 'E1': 'Complementarios.', 'E2': 'Sustitutos.', 'E3': 'Independientes.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C9', tipo: 'Micro: Producci√≥n', pregunta: "¬øQu√© representa la pendiente de la Frontera de Posibilidades de Producci√≥n?", opciones: { 'E1': 'El Costo Total.', 'E2': 'El Costo de Oportunidad.', 'E3': 'El Beneficio Marginal.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C10', tipo: 'Micro: L/P vs C/P', pregunta: "¬øQu√© factor de producci√≥n es t√≠picamente variable tanto a corto como a largo plazo?", opciones: { 'E1': 'Tierra.', 'E2': 'Capital Fijo.', 'E3': 'Trabajo.' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            
            // Macroeconom√≠a (Keynes/Friedman/Schumpeter) - Comodines: Keynes, Friedman
            { id: 'C11', tipo: 'Macro: Fiscal (Keynes)', pregunta: "¬øQu√© efecto describe el desplazamiento de la inversi√≥n privada causado por el aumento del gasto p√∫blico y la deuda?", opciones: { 'E1': 'Efecto Multiplicador.', 'E2': 'Efecto Expansivo.', 'E3': 'Efecto Desplazamiento (Crowding Out).' }, respuestaCorrecta: 'E3', comodinRequerido: 'keynes' },
            { id: 'C12', tipo: 'Monetaria (Friedman)', pregunta: "Seg√∫n la Teor√≠a Cuantitativa del Dinero, si la velocidad y la producci√≥n real son constantes, ¬øqu√© sucede si se duplica la Oferta Monetaria?", opciones: { 'E1': 'El PIB real crece.', 'E2': 'Los precios se duplican.', 'E3': 'La velocidad se reduce a la mitad.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C13', tipo: 'Macro: OA/DA', pregunta: "¬øQu√© causa un movimiento a lo largo de la Curva de Demanda Agregada (DA)?", opciones: { 'E1': 'Cambios en la Tasa de Inter√©s.', 'E2': 'Cambios en el Gasto P√∫blico.', 'E3': 'Cambios en la Oferta Monetaria.' }, respuestaCorrecta: 'E1', comodinRequerido: 'keynes' },
            { id: 'C14', tipo: 'Monetaria (Friedman)', pregunta: "¬øQu√© concepto se utiliza para describir una pol√≠tica que mantiene el crecimiento de la oferta monetaria constante, independientemente del ciclo?", opciones: { 'E1': 'Discrecionalidad.', 'E2': 'Regla de Friedman (Monetarista).', 'E3': 'Flexibilizaci√≥n Cuantitativa.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C15', tipo: 'Macro: Crecimiento', pregunta: "¬øQu√© modelo macroecon√≥mico explica el crecimiento por la acumulaci√≥n de capital f√≠sico, humano y tecnolog√≠a ex√≥gena?", opciones: { 'E1': 'Modelo Neocl√°sico de Solow.', 'E2': 'Modelo de Crecimiento End√≥geno.', 'E3': 'Modelo de la Trampa de Pobreza.' }, respuestaCorrecta: 'E1', comodinRequerido: 'keynes' },
            { id: 'C16', tipo: 'Monetaria (General)', pregunta: "La **Curva de Phillips de Largo Plazo** es vertical en la tasa natural de desempleo. ¬øQu√© implicaci√≥n tiene esto?", opciones: { 'E1': 'El desempleo puede eliminarse con inflaci√≥n.', 'E2': 'No hay *trade-off* entre inflaci√≥n y desempleo a largo plazo.', 'E3': 'La inflaci√≥n es siempre cero.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C17', tipo: 'Macro: Fiscal (Keynes)', pregunta: "¬øQu√© valor debe tener el Multiplicador del Gasto para que una pol√≠tica fiscal sea altamente efectiva?", opciones: { 'E1': 'Menor a 1.', 'E2': 'Mayor a 1.', 'E3': 'Igual a 0.' }, respuestaCorrecta: 'E2', comodinRequerido: 'keynes' },
            { id: 'C18', tipo: 'Monetaria (General)', pregunta: "¬øC√≥mo se llama la situaci√≥n donde la pol√≠tica monetaria es ineficaz porque la tasa de inter√©s est√° cerca de cero y la gente acumula efectivo?", opciones: { 'E1': 'Estanflaci√≥n.', 'E2': 'Trampa de Liquidez.', 'E3': 'Burbuja de Activos.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C19', tipo: 'Macro: Schumpeter', pregunta: "En t√©rminos de crecimiento, ¬øqu√© papel juega el empresario innovador en el modelo de Schumpeter?", opciones: { 'E1': 'Simplemente capitaliza el ahorro.', 'E2': 'Es el motor ex√≥geno del cambio.', 'E3': 'Es el motor end√≥geno del cambio.' }, respuestaCorrecta: 'E3', comodinRequerido: 'keynes' },
            { id: 'C20', tipo: 'Monetaria (General)', pregunta: "¬øCu√°l es el principal objetivo del Banco Central en la mayor√≠a de las econom√≠as modernas?", opciones: { 'E1': 'Maximizar el empleo.', 'E2': 'Mantener la estabilidad de precios (baja inflaci√≥n).', 'E3': 'Financiar el d√©ficit fiscal.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' }
        ];

        // --- 3. FUNCIONES DE RENDERIZADO Y CONTROL ---

        function mostrarHistoria() {
            document.getElementById('game-area').innerHTML = `
                <div class="inicio-historia">
                    <h1>CLUE: El Misterio del Equilibrio Roto</h1>
                    <p style="font-style: italic;">"En la remota Mansi√≥n de la Econom√≠a, el Dr. Equilibrio, defensor a ultranza del estado estacionario y los rendimientos decrecientes, ha sido asesinado."</p>
                    
                    <p>La escena del crimen est√° llena de pistas contradictorias. La evidencia apunta a dos grandes te√≥ricos del crecimiento din√°mico, ambos enemigos ac√©rrimos del Dr. Equilibrio:</p>
                    
                    <ul style="text-align: left; max-width: 400px; margin: 20px auto; list-style-type: none; padding-left: 0;">
                        <li>**${sospechosos.A}:** El defensor del cambio **discontinuo** y la destrucci√≥n de estructuras viejas.</li>
                        <li>**${sospechosos.B}:** El promotor del crecimiento como proceso **continuo** impulsado por la especializaci√≥n y el tama√±o del mercado.</li>
                    </ul>

                    <p>Tu misi√≥n es resolver las 20 Pistas de Investigaci√≥n, basadas en las sutilezas de sus teor√≠as. Cada error te costar√° un **Castigo Econ√≥mico** que deber√°s resolver. ¬°El futuro del pensamiento econ√≥mico depende de tu l√≥gica!</p>
                    
                    <button onclick="iniciarJuego()">INICIAR INVESTIGACI√ìN</button>
                </div>
            `;
            document.getElementById('status').innerHTML = '';
            document.getElementById('output').innerHTML = '';
        }

        function iniciarJuego() {
            mostrarPreguntaCrimen(0);
        }

        function actualizarStatus() {
            const comodinesDisp = Object.keys(comodinesUsados)
                .filter(c => !comodinesUsados[c])
                .map(c => `<span style="color: #ffcc00;">${comodinesMapa[c]} (DISPONIBLE)</span>`)
                .join('<br>') || '<span style="color: #ef5350; font-weight: bold;">AGOTADOS</span>';

            const pistasResueltasHTML = Object.entries(pistasCrimen).map(([clave, valor]) => {
                return `<strong>${clave.split('(')[0].trim()}:</strong> ${valor}`;
            }).join('; ');

            const statusHTML = `
                <h3>ESTADO ACTUAL DE LA INVESTIGACI√ìN</h3>
                <p><strong>Pista de Crimen:</strong> ${preguntasCrimenRespondidas + 1} de ${preguntasCrimen.length}</p>
                <p><strong>Pistas Resueltas:</strong> ${pistasResueltasHTML || 'Ninguna'}</p>
                <p><strong>Expertos (Comodines):</strong><br>${comodinesDisp}</p>
                <p><strong>Castigos Usados:</strong> ${castigosUsados.length}/20</p>
            `;
            document.getElementById('status').innerHTML = statusHTML;
        }

        function mostrarPreguntaCrimen(index) {
            if (index >= preguntasCrimen.length) {
                return finDelJuego(false); 
            }
            pistaIndex = index;
            const p = preguntasCrimen[index];
            let opcionesHTML = Object.keys(p.opciones).map(key =>
                `<button onclick="manejarRespuestaCrimen('${key}', ${index})">${key}: ${p.opciones[key]}</button>`
            ).join('<br><br>');

            document.getElementById('game-area').innerHTML = `
                <h2>Pista ${index + 1}: ${p.tipo}</h2>
                <div class="pregunta">
                    <p><strong>Detalle del Caso:</strong> "${p.pregunta}"</p>
                    <h3>‚ùì Tu Decisi√≥n (Elige solo una)</h3>
                    ${opcionesHTML}
                </div>
            `;
            actualizarStatus();
        }

        function obtenerNuevoCastigo() {
            const comodinesDisponibles = Object.keys(comodinesUsados).filter(c => !comodinesUsados[c]).length;
            const castigosDisponibles = bancoCastigos.filter(c => !castigosUsados.includes(c.id));
            
            if (castigosDisponibles.length === 0 && comodinesDisponibles > 0) {
                 const castigoDeAgotamiento = {
                    comodinRequerido: Object.keys(comodinesUsados).filter(c => !comodinesUsados[c])[0]
                 };
                 mostrarComodin(castigoDeAgotamiento);
                 return;
            } else if (castigosDisponibles.length === 0 && comodinesDisponibles === 0) {
                 return finDelJuego(true);
            }
            
            const castigo = castigosDisponibles[Math.floor(Math.random() * castigosDisponibles.length)];
            castigosUsados.push(castigo.id);
            return castigo;
        }

        function mostrarCastigo(castigo) {
            const p = castigo;
            castigoActual = castigo;
            let opcionesHTML = Object.keys(p.opciones).map(key =>
                `<button onclick="manejarRespuestaCastigo('${key}')">${key}: ${p.opciones[key]}</button>`
            ).join('<br><br>');

            document.getElementById('game-area').innerHTML = `
                <h2>‚ùå CASTIGO ECON√ìMICO: ¬°Error en la Pista!</h2>
                <div class="pregunta error">
                    <p>¬°Respuesta de la investigaci√≥n **INCORRECTA**! La pista se ha bloqueado. Debes resolver este enigma de **${p.tipo}** para continuar. ¬°La ineficiencia te persigue!</p>
                    <p><strong>Acertijo Econ√≥mico ${p.id}:</strong> ${p.pregunta}</p>
                    <h3>‚ùì Tu Decisi√≥n Econ√≥mica (Elige solo una)</h3>
                    ${opcionesHTML}
                </div>
            `;
        }

        function mostrarComodin(castigo) {
            const comodinesDisp = Object.keys(comodinesUsados).filter(c => !comodinesUsados[c]);
            if (comodinesDisp.length === 0) {
                return finDelJuego(true); 
            }
            const comodinRequerido = castigo.comodinRequerido || comodinesDisp[Math.floor(Math.random() * comodinesDisp.length)];
            const comodinNombre = comodinesMapa[comodinRequerido];
            
            let comodinesHTML = comodinesDisp
                .map(key => `<button class="comodin" onclick="manejarComodin('${key}', '${comodinRequerido}')">${comodinesMapa[key]}</button>`)
                .join(' ');
            
            document.getElementById('game-area').innerHTML = `
                <h2>üö® EMERGENCIA: Uso de Experto (Comod√≠n) üö®</h2>
                <div class="pregunta error">
                    <p>La l√≥gica econ√≥mica es inestable. Necesitas la intervenci√≥n de un experto en ${comodinNombre} (Problema de ${comodinNombre.split('(')[0].trim()}) para desbloquear la pista.</p>
                    <h3>‚ùì ¬øA qui√©n usas para corregir?</h3>
                    <p style="color: white; font-weight: bold; background-color: rgba(0,0,0,0.3); padding: 5px;">¬°Elige al experto correcto! Fallar ahora o usar uno ya usado significa la derrota total.</p>
                    ${comodinesHTML}
                </div>
            `;
        }

        // --- 4. MANEJO DE RESPUESTAS ---

        function manejarRespuestaCrimen(respuesta, index) {
            const p = preguntasCrimen[index];
            document.getElementById('output').innerHTML = ''; 

            if (respuesta === p.respuestaCorrecta) {
                pistasCrimen[p.clave] = p.valor;
                preguntasCrimenRespondidas++;
                document.getElementById('output').innerHTML = `<div style="color: #4CAF50; font-weight: bold;">‚úÖ PISTA OBTENIDA: ¬°${p.clave.toUpperCase().split('(')[0].trim()} resuelto! ${p.valor}.</div>`;
                mostrarPreguntaCrimen(index + 1);
            } else {
                const castigo = obtenerNuevoCastigo();
                if (castigo) {
                    document.getElementById('output').innerHTML = `<div style="color: #ffcc00; font-weight: bold;">‚ùå FALLO EN EL CRIMEN: La respuesta '${respuesta}' es incorrecta.</div>`;
                    if(castigo.id) { 
                        mostrarCastigo(castigo);
                    }
                }
            }
        }

        function manejarRespuestaCastigo(respuestaEconomica) {
            const castigo = castigoActual;
            if (respuestaEconomica === castigo.respuestaCorrecta) {
                const pistaGanada = preguntasCrimen[pistaIndex];
                pistasCrimen[pistaGanada.clave] = pistaGanada.valor;
                preguntasCrimenRespondidas++;

                document.getElementById('output').innerHTML += `<div style="color: #4CAF50; font-weight: bold; margin-top: 15px;">‚úÖ CASTIGO RESUELTO: Respuesta econ√≥mica correcta. ¬°La pista **${pistaGanada.clave.toUpperCase().split('(')[0].trim()}** se ha desbloqueado!</div>`;
                mostrarPreguntaCrimen(preguntasCrimenRespondidas);
            } else {
                document.getElementById('output').innerHTML += `<div style="color: #ffcc00; font-weight: bold; margin-top: 15px;">‚ùå FALLO EN EL ACERTIJO: Respuesta econ√≥mica incorrecta. ¬°Debes usar un Experto!</div>`;
                mostrarComodin(castigo);
            }
        }

        function manejarComodin(comodinElegido, comodinRequerido) {
            if (comodinesUsados[comodinElegido]) {
                document.getElementById('output').innerHTML += `<div style="color: #ef5350; font-weight: bold; margin-top: 15px;">‚ö†Ô∏è ERROR FATAL: El comod√≠n de ${comodinesMapa[comodinElegido]} ya fue usado.</div>`;
                return finDelJuego(true);
            }

            if (comodinElegido === comodinRequerido) {
                comodinesUsados[comodinElegido] = true;
                
                const pistaGanada = preguntasCrimen[pistaIndex];
                pistasCrimen[pistaGanada.clave] = pistaGanada.valor;
                preguntasCrimenRespondidas++;

                document.getElementById('output').innerHTML += `<div style="color: #ffd700; font-weight: bold; margin-top: 15px;">üåü COMOD√çN EXITOSO: ${comodinesMapa[comodinElegido]} corrige la respuesta. ¬°La pista **${pistaGanada.clave.toUpperCase().split('(')[0].trim()}** se ha desbloqueado!</div>`;
                mostrarPreguntaCrimen(preguntasCrimenRespondidas);
            } else {
                comodinesUsados[comodinElegido] = true;
                document.getElementById('output').innerHTML += `<div style="color: #ef5350; font-weight: bold; margin-top: 15px;">‚ùå ERROR FATAL: Elegiste a ${comodinesMapa[comodinElegido]} para un problema incorrecto. ¬°Tu ineficiencia econ√≥mica caus√≥ la derrota!</div>`;
                return finDelJuego(true);
            }
        }

        function finDelJuego(fallo) {
            if (fallo) {
                document.getElementById('game-area').innerHTML = `<h1 style="color: #b71c1c;">üí• ¬°HAS FALLADO! üí•</h1>
                    <p>La l√≥gica econ√≥mica se ha roto, la escasez de recursos te ha vencido. No pudiste resolver el misterio.</p>
                    <h2>Has fallado, la econom√≠a mundial ha colapsado. üìâ</h2>
                    <p>Vuelve a cargar la p√°gina para intentar de nuevo.</p>`;
            } else {
                const pistasFinal = Object.entries(pistasCrimen).map(([clave, valor]) => {
                    return `<li><strong>${clave.toUpperCase().split('(')[0].trim()}:</strong> ${valor}</li>`;
                }).join('');
                
                document.getElementById('game-area').innerHTML = `<h1 style="color: #4CAF50;">üéâ ¬°CRIMEN RESUELTO! üéâ</h1>
                    <p>¬°Has salvado a la disciplina econ√≥mica! El misterio ha sido revelado:</p>
                    <ul style="text-align: left; list-style-type: disc;">${pistasFinal}</ul>
                    <p><strong>El culpable final es: ${pistasCrimen.ASESINO}</strong></p>
                    <p>¬°Misi√≥n cumplida!</p>`;
            }
            document.getElementById('status').innerHTML = '';
        }
        
        // --- 5. INICIO DEL JUEGO ---
        document.addEventListener('DOMContentLoaded', () => {
            mostrarHistoria();
        });
    </script>
</body>
</html>
