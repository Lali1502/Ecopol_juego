<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLUE: El Misterio del Equilibrio Roto (RETO FINAL)</title>
    <style>
        /* ESTILOS GLOBALES */
        body {
            font-family: 'Georgia', serif;
            background-color: #0d1a26; /* Fondo oscuro, como la noche */
            color: #f4f4f9;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 800px;
            margin: 40px auto;
            background: #1c2b38; /* Fondo un poco más claro para el contenido del juego */
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.1);
            min-height: 500px;
        }
        h1, h2, h3 {
            color: #ffcc00; /* Dorado viejo para el misterio */
            border-bottom: 2px solid #555;
            padding-bottom: 10px;
        }
        
        /* ESTILOS DE LA PÁGINA DE INICIO (MANSIÓN) */
        .inicio-historia {
            text-align: center;
            padding: 50px 20px;
            /* Nota: Si quieres cambiar la imagen, reemplaza la URL a continuación. 
               Esta es una imagen de stock de una mansión misteriosa */
            background-image: url('https://i.imgur.com/f3Gj0t2.png'); 
            background-size: cover;
            background-position: center;
            color: white;
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            text-shadow: 1px 1px 5px #000;
        }
        .inicio-historia h1 {
            border-bottom: none;
            font-size: 2.8em;
            color: #ffd700; /* Dorado */
            margin-bottom: 5px;
        }
        .inicio-historia p {
            background-color: rgba(0, 0, 0, 0.6); /* Fondo semi-transparente para leer mejor */
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        /* ESTILOS DEL JUEGO */
        .status, .pregunta {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .status {
            background-color: #3f51b5; /* Azul oscuro */
            border: 1px solid #7986cb;
            color: white;
        }
        .pregunta {
            background-color: #5c6bc0; /* Azul medio */
            border: 1px solid #9fa8da;
            color: white;
        }
        .error {
            background-color: #b71c1c; /* Rojo oscuro */
            border: 1px solid #ef5350;
            color: white;
        }
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            background-color: #ffd700; /* Botones dorados/amarillos */
            color: #333;
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.2s;
        }
        button:hover {
            background-color: #ffc107;
            transform: scale(1.05);
        }
        button.comodin {
            background-color: #00796b; /* Verde oscuro */
            color: white;
        }
        button.comodin:hover {
            background-color: #004d40;
        }
        #output {
            margin-top: 30px;
            padding: 20px;
            background-color: #263238; /* Gris oscuro para el output */
            border-radius: 5px;
            white-space: pre-wrap;
            color: #eceff1;
        }
        #output div {
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="status"></div>
        <div id="game-area"></div>
        <div id="output"></div>
    </div>

    <script>
        // --- 1. ESTADO GLOBAL DEL JUEGO ---
        let comodinesUsados = {
            smith: false, 
            keynes: false, 
            friedman: false 
        };
        let comodinesMapa = {
            'smith': 'Adam Smith (Micro)',
            'keynes': 'J.M. Keynes (Fiscal)',
            'friedman': 'M. Friedman (Monetaria)'
        };
        
        let pistasCrimen = {}; 
        let castigoActual = null;
        let preguntasCrimenRespondidas = 0;
        let castigosUsados = []; 
        let pistaIndex = 0; 
        
        const sospechosos = {
            A: 'Dr. Joseph A. Schumpeter (Desenvolvimiento)',
            B: 'Profesor Allyn A. Young (Rendimientos)'
        };

        // --- 2. CONTENIDO DEL JUEGO (Mismo contenido, alta complejidad) ---
        const preguntasCrimen = [
            // P1-P4: Pistas principales (Asesino, Arma, Lugar, Móvil)
            { id: 'P1', tipo: 'Asesino', pregunta: "Se encontró un texto de la víctima donde ridiculizaba la idea de que el crecimiento es un proceso de **desequilibrio crónico** y acumulativo. ¿A quién incrimina este móvil ideológico?", opciones: { 'A': sospechosos.A, 'B': sospechosos.B }, respuestaCorrecta: 'B', clave: 'ASESINO', valor: 'Profesor Allyn A. Young' },
            { id: 'P2', tipo: 'Arma', pregunta: "El arma del crimen fue usada para eliminar la **corriente circular** del estado de reposo, forzando un cambio cualitativo. ¿Qué concepto representa el arma?", opciones: { 'A': 'La Innovación (Destrucción Creadora)', 'B': 'La División del Trabajo (Especialización)' }, respuestaCorrecta: 'A', clave: 'ARMA', valor: 'Innovación (Destrucción Creadora)' },
            { id: 'P3', tipo: 'Lugar', pregunta: "El crimen ocurrió en el lugar donde los rendimientos decrecientes actuaban como **el principal obstáculo** al crecimiento. ¿Qué elemento limitaba la acción del asesino según su propia teoría?", opciones: { 'A': 'El escaso pool de capital disponible.', 'B': 'La inelasticidad relativa de la demanda.' }, respuestaCorrecta: 'B', clave: 'LUGAR', valor: 'Sala de la Inelasticidad Relativa' },
            { id: 'P4', tipo: 'Móvil', pregunta: "La víctima fue encontrada con una nota que citaba a Marshall: 'El crecimiento viene de fuera'. ¿Qué teórico fue el móvil principal del crimen al afirmar que el crecimiento viene **de dentro**?", opciones: { 'A': sospechosos.A, 'B': sospechosos.B }, respuestaCorrecta: 'A', clave: 'MÓVIL', valor: 'La Endogeneidad del Desarrollo (Schumpeter)' },
            
            // P5-P20: Pistas de refuerzo y coartadas complejas
            { id: 'P5', tipo: 'Coartada', pregunta: "El Dr. Schumpeter alegó que estaba **financiando un nuevo proyecto** con crédito bancario. ¿Es esto una coartada sólida o un indicio de su involucramiento según su propia teoría?", opciones: { 'A': 'Indicio (La innovación requiere crédito bancario).', 'B': 'Coartada (Estaba ocupado con el capital propio).' }, respuestaCorrecta: 'A', clave: 'PISTA 5 (Crédito)', valor: 'Crédito Bancario como Indicio' },
            { id: 'P6', tipo: 'Especialización', pregunta: "Si el crimen fue perpetrado por Young, debió maximizar la **división del trabajo** en el acto. ¿Qué acción ilustra mejor la división del trabajo?", opciones: { 'A': 'La creación de un nuevo producto para el crimen.', 'B': 'La externalización de la vigilancia a un tercero.' }, respuestaCorrecta: 'B', clave: 'PISTA 6 (División)', valor: 'Externalización de tareas' },
            { id: 'P7', tipo: 'Equilibrio', pregunta: "El asesino dejó un diagrama de curvas de indiferencia inclinadas. Según Young, este hallazgo implica que el Dr. Equilibrio buscaba: ", opciones: { 'A': 'Rendimientos crecientes.', 'B': 'Sustitución de factores por el mismo costo.' }, respuestaCorrecta: 'B', clave: 'PISTA 7 (Isocostos)', valor: 'Sustitución en Isocostos' },
            { id: 'P8', tipo: 'Estática', pregunta: "Schumpeter separa **crecimiento** de **desenvolvimiento**. ¿Qué fenómeno económico representa el simple crecimiento que Schumpeter considera dentro de la 'estática'?", opciones: { 'A': 'La innovación tecnológica.', 'B': 'El aumento de la población.' }, respuestaCorrecta: 'B', clave: 'PISTA 8 (Estática)', valor: 'Aumento Demográfico' },
            { id: 'P9', tipo: 'Demanda', pregunta: "Según la nota (4) de Young, para que un avance sea ventajoso, debe **modificar favorablemente** la curvatura de las curvas de isocostos. ¿Qué implica esto?", opciones: { 'A': 'Solo un cambio en el precio de los factores.', 'B': 'Un cambio en las elasticidades relativas.' }, respuestaCorrecta: 'B', clave: 'PISTA 9 (Curvatura)', valor: 'Cambio en Elasticidades' },
            { id: 'P10', tipo: 'Tecnología', pregunta: "Si Schumpeter fue el asesino, el crimen fue un acto de **Destrucción Creadora**. ¿Qué destruye este acto en el proceso?", opciones: { 'A': 'El capital de la competencia.', 'B': 'Las estructuras económicas obsoletas.' }, respuestaCorrecta: 'B', clave: 'PISTA 10 (Destrucción)', valor: 'Estructuras Obsoletas' },
            { id: 'P11', tipo: 'Retornos', pregunta: "Young sostiene que el progreso es el resultado de la evolución del proceso productivo, ¿pero cuál es la **causa del progreso** en su teoría?", opciones: { 'A': 'La simple acumulación de capital.', 'B': 'El progreso es la causa del progreso.' }, respuestaCorrecta: 'B', clave: 'PISTA 11 (Causa)', valor: 'Progreso Autocausado' },
            { id: 'P12', tipo: 'Monopolio', pregunta: "Schumpeter defendía el **monopolio temporal** de la innovación. El Dr. Equilibrio fue asesinado justo después de defender la competencia perfecta. ¿Qué justifica Schumpeter en el monopolio?", opciones: { 'A': 'Permite la distribución justa de la renta.', 'B': 'Asegura las ganancias extraordinarias para innovar.' }, respuestaCorrecta: 'B', clave: 'PISTA 12 (Monopolio)', valor: 'Ganancias Extraordinarias' },
            { id: 'P13', tipo: 'Desequilibrio', pregunta: "Young enfatiza que el crecimiento es un proceso de **desequilibrio continuo** y no de ajustes a nuevos equilibrios. ¿Qué implica esto para el rol del mercado?", opciones: { 'A': 'El mercado siempre tiende a corregir fallos.', 'B': 'El mercado opera en un desajuste permanente.' }, respuestaCorrecta: 'B', clave: 'PISTA 13 (Mercado)', valor: 'Desajuste Permanente' },
            { id: 'P14', tipo: 'Empresario', pregunta: "El empresario schumpeteriano no es un administrador, sino un **héroe**. ¿Qué función principal lo diferencia del simple capitalista?", opciones: { 'A': 'El manejo eficiente del capital.', 'B': 'La combinación de factores de forma nueva.' }, respuestaCorrecta: 'B', clave: 'PISTA 14 (Héroe)', valor: 'Nueva Combinación de Factores' },
            { id: 'P15', tipo: 'Externalidades', pregunta: "El crimen involucró una **externalidad positiva** al sector de la vigilancia. Según Young, este fenómeno es crucial para...", opciones: { 'A': 'Convertir rendimientos internos en rendimientos externos.', 'B': 'Estabilizar los ciclos económicos.' }, respuestaCorrecta: 'A', clave: 'PISTA 15 (Externalidad)', valor: 'Retornos de Escala Externos' },
            { id: 'P16', tipo: 'Ciclos', pregunta: "Schumpeter vincula el **ciclo económico** a los *clusters* de innovación. ¿Qué fase del ciclo es causada por la implementación masiva de innovaciones?", opciones: { 'A': 'La depresión.', 'B': 'El auge.' }, respuestaCorrecta: 'B', clave: 'PISTA 16 (Ciclo)', valor: 'El Auge del Ciclo' },
            { id: 'P17', tipo: 'Límite', pregunta: "Young cita a Smith: La división del trabajo es limitada por el tamaño del mercado. ¿Qué factor **no** limita la división del trabajo según Young?", opciones: { 'A': 'El potencial humano.', 'B': 'La magnitud de la demanda.' }, respuestaCorrecta: 'A', clave: 'PISTA 17 (Límite)', valor: 'Potencial Humano (No Limitante)' },
            { id: 'P18', tipo: 'Dinero', pregunta: "El Dr. Equilibrio fue asfixiado con un billete que representaba el **dinero estático**. ¿Qué representa el dinero dinámico en Schumpeter?", opciones: { 'A': 'Un medio de cambio neutral.', 'B': 'Un vehículo de transferencia de poder de compra (crédito).' }, respuestaCorrecta: 'B', clave: 'PISTA 18 (Dinero)', valor: 'Crédito Dinámico' },
            { id: 'P19', tipo: 'Cambio', pregunta: "Según Young, si -dy/dx aumenta en relación con y/x en las curvas de indiferencia, la amplitud del movimiento en la dirección de P1 **se incrementa**. ¿Qué principio microeconómico avanzado describe esta relación?", opciones: { 'A': 'Elasticidad de sustitución.', 'B': 'Tasa marginal de sustitución decreciente.' }, respuestaCorrecta: 'A', clave: 'PISTA 19 (Isocostos II)', valor: 'Elasticidad de Sustitución' },
            { id: 'P20', tipo: 'Capitalismo', pregunta: "El Dr. Equilibrio era pesimista sobre el futuro del capitalismo. ¿Qué factor predijo Schumpeter que, irónicamente, **destruiría** el capitalismo que él tanto defendía?", opciones: { 'A': 'La sobreacumulación de capital.', 'B': 'La racionalización de la innovación.' }, respuestaCorrecta: 'B', clave: 'PISTA 20 (Final)', valor: 'Racionalización de la Innovación' }
        ];

        const bancoCastigos = [
            // Microeconomía (Smith/Young) - Comodín: Smith
            { id: 'C1', tipo: 'Micro: Fallo de Mercado', pregunta: "En un mercado con externalidades positivas, ¿dónde se ubica el óptimo social en relación con el óptimo privado?", opciones: { 'E1': 'A la izquierda (menor cantidad).', 'E2': 'A la derecha (mayor cantidad).', 'E3': 'Coinciden.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C2', tipo: 'Micro: Monopolio', pregunta: "Para un monopolista, ¿cómo se relaciona el Ingreso Marginal (IM) con el Precio (P)?", opciones: { 'E1': 'IM = P', 'E2': 'IM > P', 'E3': 'IM < P' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            { id: 'C3', tipo: 'Micro: Escala', pregunta: "Los rendimientos crecientes a escala se asocian a una Curva de Costo Total Promedio de Largo Plazo (CTP L/P):", opciones: { 'E1': 'Creciente.', 'E2': 'Decreciente.', 'E3': 'Constante.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C4', tipo: 'Micro: Curvas', pregunta: "¿Qué mide la pendiente de la Curva de Indiferencia?", opciones: { 'E1': 'La Relación Marginal de Transformación.', 'E2': 'La Tasa Marginal de Sustitución.', 'E3': 'El Precio Relativo.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C5', tipo: 'Micro: Bienes', pregunta: "Si la elasticidad ingreso de la demanda es negativa, el bien es considerado:", opciones: { 'E1': 'Normal.', 'E2': 'Superior.', 'E3': 'Inferior.' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            { id: 'C6', tipo: 'Micro: Competencia', pregunta: "¿Qué condición se cumple para una empresa en competencia perfecta a largo plazo?", opciones: { 'E1': 'Precio > CTP.', 'E2': 'Precio = CTP mínimo.', 'E3': 'IM < CM.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C7', tipo: 'Micro: Riesgo', pregunta: "¿Qué teoría explica cómo la información asimétrica lleva a que solo las peores opciones permanezcan en el mercado (como en los autos usados)?", opciones: { 'E1': 'Riesgo Moral.', 'E2': 'Selección Adversa.', 'E3': 'Teorema de Coase.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C8', tipo: 'Micro: Elasticidad', pregunta: "Si la elasticidad cruzada es +0.5, los bienes son:", opciones: { 'E1': 'Complementarios.', 'E2': 'Sustitutos.', 'E3': 'Independientes.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C9', tipo: 'Micro: Producción', pregunta: "¿Qué representa la pendiente de la Frontera de Posibilidades de Producción?", opciones: { 'E1': 'El Costo Total.', 'E2': 'El Costo de Oportunidad.', 'E3': 'El Beneficio Marginal.' }, respuestaCorrecta: 'E2', comodinRequerido: 'smith' },
            { id: 'C10', tipo: 'Micro: L/P vs C/P', pregunta: "¿Qué factor de producción es típicamente variable tanto a corto como a largo plazo?", opciones: { 'E1': 'Tierra.', 'E2': 'Capital Fijo.', 'E3': 'Trabajo.' }, respuestaCorrecta: 'E3', comodinRequerido: 'smith' },
            
            // Macroeconomía (Keynes/Friedman/Schumpeter) - Comodines: Keynes, Friedman
            { id: 'C11', tipo: 'Macro: Fiscal (Keynes)', pregunta: "¿Qué efecto describe el desplazamiento de la inversión privada causado por el aumento del gasto público y la deuda?", opciones: { 'E1': 'Efecto Multiplicador.', 'E2': 'Efecto Expansivo.', 'E3': 'Efecto Desplazamiento (Crowding Out).' }, respuestaCorrecta: 'E3', comodinRequerido: 'keynes' },
            { id: 'C12', tipo: 'Monetaria (Friedman)', pregunta: "Según la Teoría Cuantitativa del Dinero, si la velocidad y la producción real son constantes, ¿qué sucede si se duplica la Oferta Monetaria?", opciones: { 'E1': 'El PIB real crece.', 'E2': 'Los precios se duplican.', 'E3': 'La velocidad se reduce a la mitad.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C13', tipo: 'Macro: OA/DA', pregunta: "¿Qué causa un movimiento a lo largo de la Curva de Demanda Agregada (DA)?", opciones: { 'E1': 'Cambios en la Tasa de Interés.', 'E2': 'Cambios en el Gasto Público.', 'E3': 'Cambios en la Oferta Monetaria.' }, respuestaCorrecta: 'E1', comodinRequerido: 'keynes' },
            { id: 'C14', tipo: 'Monetaria (Friedman)', pregunta: "¿Qué concepto se utiliza para describir una política que mantiene el crecimiento de la oferta monetaria constante, independientemente del ciclo?", opciones: { 'E1': 'Discrecionalidad.', 'E2': 'Regla de Friedman (Monetarista).', 'E3': 'Flexibilización Cuantitativa.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C15', tipo: 'Macro: Crecimiento', pregunta: "¿Qué modelo macroeconómico explica el crecimiento por la acumulación de capital físico, humano y tecnología exógena?", opciones: { 'E1': 'Modelo Neoclásico de Solow.', 'E2': 'Modelo de Crecimiento Endógeno.', 'E3': 'Modelo de la Trampa de Pobreza.' }, respuestaCorrecta: 'E1', comodinRequerido: 'keynes' },
            { id: 'C16', tipo: 'Monetaria (General)', pregunta: "La **Curva de Phillips de Largo Plazo** es vertical en la tasa natural de desempleo. ¿Qué implicación tiene esto?", opciones: { 'E1': 'El desempleo puede eliminarse con inflación.', 'E2': 'No hay *trade-off* entre inflación y desempleo a largo plazo.', 'E3': 'La inflación es siempre cero.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C17', tipo: 'Macro: Fiscal (Keynes)', pregunta: "¿Qué valor debe tener el Multiplicador del Gasto para que una política fiscal sea altamente efectiva?", opciones: { 'E1': 'Menor a 1.', 'E2': 'Mayor a 1.', 'E3': 'Igual a 0.' }, respuestaCorrecta: 'E2', comodinRequerido: 'keynes' },
            { id: 'C18', tipo: 'Monetaria (General)', pregunta: "¿Cómo se llama la situación donde la política monetaria es ineficaz porque la tasa de interés está cerca de cero y la gente acumula efectivo?", opciones: { 'E1': 'Estanflación.', 'E2': 'Trampa de Liquidez.', 'E3': 'Burbuja de Activos.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' },
            { id: 'C19', tipo: 'Macro: Schumpeter', pregunta: "En términos de crecimiento, ¿qué papel juega el empresario innovador en el modelo de Schumpeter?", opciones: { 'E1': 'Simplemente capitaliza el ahorro.', 'E2': 'Es el motor exógeno del cambio.', 'E3': 'Es el motor endógeno del cambio.' }, respuestaCorrecta: 'E3', comodinRequerido: 'keynes' },
            { id: 'C20', tipo: 'Monetaria (General)', pregunta: "¿Cuál es el principal objetivo del Banco Central en la mayoría de las economías modernas?", opciones: { 'E1': 'Maximizar el empleo.', 'E2': 'Mantener la estabilidad de precios (baja inflación).', 'E3': 'Financiar el déficit fiscal.' }, respuestaCorrecta: 'E2', comodinRequerido: 'friedman' }
        ];

        // --- 3. FUNCIONES DE RENDERIZADO Y CONTROL ---

        function mostrarHistoria() {
            document.getElementById('game-area').innerHTML = `
                <div class="inicio-historia">
                    <h1>CLUE: El Misterio del Equilibrio Roto</h1>
                    <p style="font-style: italic;">"En la remota Mansión de la Economía, el Dr. Equilibrio, defensor a ultranza del estado estacionario y los rendimientos decrecientes, ha sido asesinado."</p>
                    
                    <p>La escena del crimen está llena de pistas contradictorias. La evidencia apunta a dos grandes teóricos del crecimiento dinámico, ambos enemigos acérrimos del Dr. Equilibrio:</p>
                    
                    <ul style="text-align: left; max-width: 400px; margin: 20px auto; list-style-type: none; padding-left: 0;">
                        <li>**${sospechosos.A}:** El defensor del cambio **discontinuo** y la destrucción de estructuras viejas.</li>
                        <li>**${sospechosos.B}:** El promotor del crecimiento como proceso **continuo** impulsado por la especialización y el tamaño del mercado.</li>
                    </ul>

                    <p>Tu misión es resolver las 20 Pistas de Investigación, basadas en las sutilezas de sus teorías. Cada error te costará un **Castigo Económico** que deberás resolver. ¡El futuro del pensamiento económico depende de tu lógica!</p>
                    
                    <button onclick="iniciarJuego()">INICIAR INVESTIGACIÓN</button>
                </div>
            `;
            document.getElementById('status').innerHTML = '';
            document.getElementById('output').innerHTML = '';
        }

        function iniciarJuego() {
            mostrarPreguntaCrimen(0);
        }

        function actualizarStatus() {
            const comodinesDisp = Object.keys(comodinesUsados)
                .filter(c => !comodinesUsados[c])
                .map(c => `<span style="color: #ffcc00;">${comodinesMapa[c]} (DISPONIBLE)</span>`)
                .join('<br>') || '<span style="color: #ef5350; font-weight: bold;">AGOTADOS</span>';

            const pistasResueltasHTML = Object.entries(pistasCrimen).map(([clave, valor]) => {
                return `<strong>${clave.split('(')[0].trim()}:</strong> ${valor}`;
            }).join('; ');

            const statusHTML = `
                <h3>ESTADO ACTUAL DE LA INVESTIGACIÓN</h3>
                <p><strong>Pista de Crimen:</strong> ${preguntasCrimenRespondidas + 1} de ${preguntasCrimen.length}</p>
                <p><strong>Pistas Resueltas:</strong> ${pistasResueltasHTML || 'Ninguna'}</p>
                <p><strong>Expertos (Comodines):</strong><br>${comodinesDisp}</p>
                <p><strong>Castigos Usados:</strong> ${castigosUsados.length}/20</p>
            `;
            document.getElementById('status').innerHTML = statusHTML;
        }

        function mostrarPreguntaCrimen(index) {
            if (index >= preguntasCrimen.length) {
                return finDelJuego(false); 
            }
            pistaIndex = index;
            const p = preguntasCrimen[index];
            let opcionesHTML = Object.keys(p.opciones).map(key =>
                `<button onclick="manejarRespuestaCrimen('${key}', ${index})">${key}: ${p.opciones[key]}</button>`
            ).join('<br><br>');

            document.getElementById('game-area').innerHTML = `
                <h2>Pista ${index + 1}: ${p.tipo}</h2>
                <div class="pregunta">
                    <p><strong>Detalle del Caso:</strong> "${p.pregunta}"</p>
                    <h3>❓ Tu Decisión (Elige solo una)</h3>
                    ${opcionesHTML}
                </div>
            `;
            actualizarStatus();
        }

        function obtenerNuevoCastigo() {
            const comodinesDisponibles = Object.keys(comodinesUsados).filter(c => !comodinesUsados[c]).length;
            const castigosDisponibles = bancoCastigos.filter(c => !castigosUsados.includes(c.id));
            
            if (castigosDisponibles.length === 0 && comodinesDisponibles > 0) {
                 const castigoDeAgotamiento = {
                    comodinRequerido: Object.keys(comodinesUsados).filter(c => !comodinesUsados[c])[0]
                 };
                 mostrarComodin(castigoDeAgotamiento);
                 return;
            } else if (castigosDisponibles.length === 0 && comodinesDisponibles === 0) {
                 return finDelJuego(true);
            }
            
            const castigo = castigosDisponibles[Math.floor(Math.random() * castigosDisponibles.length)];
            castigosUsados.push(castigo.id);
            return castigo;
        }

        function mostrarCastigo(castigo) {
            const p = castigo;
            castigoActual = castigo;
            let opcionesHTML = Object.keys(p.opciones).map(key =>
                `<button onclick="manejarRespuestaCastigo('${key}')">${key}: ${p.opciones[key]}</button>`
            ).join('<br><br>');

            document.getElementById('game-area').innerHTML = `
                <h2>❌ CASTIGO ECONÓMICO: ¡Error en la Pista!</h2>
                <div class="pregunta error">
                    <p>¡Respuesta de la investigación **INCORRECTA**! La pista se ha bloqueado. Debes resolver este enigma de **${p.tipo}** para continuar. ¡La ineficiencia te persigue!</p>
                    <p><strong>Acertijo Económico ${p.id}:</strong> ${p.pregunta}</p>
                    <h3>❓ Tu Decisión Económica (Elige solo una)</h3>
                    ${opcionesHTML}
                </div>
            `;
        }

        function mostrarComodin(castigo) {
            const comodinesDisp = Object.keys(comodinesUsados).filter(c => !comodinesUsados[c]);
            if (comodinesDisp.length === 0) {
                return finDelJuego(true); 
            }
            const comodinRequerido = castigo.comodinRequerido || comodinesDisp[Math.floor(Math.random() * comodinesDisp.length)];
            const comodinNombre = comodinesMapa[comodinRequerido];
            
            let comodinesHTML = comodinesDisp
                .map(key => `<button class="comodin" onclick="manejarComodin('${key}', '${comodinRequerido}')">${comodinesMapa[key]}</button>`)
                .join(' ');
            
            document.getElementById('game-area').innerHTML = `
                <h2>🚨 EMERGENCIA: Uso de Experto (Comodín) 🚨</h2>
                <div class="pregunta error">
                    <p>La lógica económica es inestable. Necesitas la intervención de un experto en ${comodinNombre} (Problema de ${comodinNombre.split('(')[0].trim()}) para desbloquear la pista.</p>
                    <h3>❓ ¿A quién usas para corregir?</h3>
                    <p style="color: white; font-weight: bold; background-color: rgba(0,0,0,0.3); padding: 5px;">¡Elige al experto correcto! Fallar ahora o usar uno ya usado significa la derrota total.</p>
                    ${comodinesHTML}
                </div>
            `;
        }

        // --- 4. MANEJO DE RESPUESTAS ---

        function manejarRespuestaCrimen(respuesta, index) {
            const p = preguntasCrimen[index];
            document.getElementById('output').innerHTML = ''; 

            if (respuesta === p.respuestaCorrecta) {
                pistasCrimen[p.clave] = p.valor;
                preguntasCrimenRespondidas++;
                document.getElementById('output').innerHTML = `<div style="color: #4CAF50; font-weight: bold;">✅ PISTA OBTENIDA: ¡${p.clave.toUpperCase().split('(')[0].trim()} resuelto! ${p.valor}.</div>`;
                mostrarPreguntaCrimen(index + 1);
            } else {
                const castigo = obtenerNuevoCastigo();
                if (castigo) {
                    document.getElementById('output').innerHTML = `<div style="color: #ffcc00; font-weight: bold;">❌ FALLO EN EL CRIMEN: La respuesta '${respuesta}' es incorrecta.</div>`;
                    if(castigo.id) { 
                        mostrarCastigo(castigo);
                    }
                }
            }
        }

        function manejarRespuestaCastigo(respuestaEconomica) {
            const castigo = castigoActual;
            if (respuestaEconomica === castigo.respuestaCorrecta) {
                const pistaGanada = preguntasCrimen[pistaIndex];
                pistasCrimen[pistaGanada.clave] = pistaGanada.valor;
                preguntasCrimenRespondidas++;

                document.getElementById('output').innerHTML += `<div style="color: #4CAF50; font-weight: bold; margin-top: 15px;">✅ CASTIGO RESUELTO: Respuesta económica correcta. ¡La pista **${pistaGanada.clave.toUpperCase().split('(')[0].trim()}** se ha desbloqueado!</div>`;
                mostrarPreguntaCrimen(preguntasCrimenRespondidas);
            } else {
                document.getElementById('output').innerHTML += `<div style="color: #ffcc00; font-weight: bold; margin-top: 15px;">❌ FALLO EN EL ACERTIJO: Respuesta económica incorrecta. ¡Debes usar un Experto!</div>`;
                mostrarComodin(castigo);
            }
        }

        function manejarComodin(comodinElegido, comodinRequerido) {
            if (comodinesUsados[comodinElegido]) {
                document.getElementById('output').innerHTML += `<div style="color: #ef5350; font-weight: bold; margin-top: 15px;">⚠️ ERROR FATAL: El comodín de ${comodinesMapa[comodinElegido]} ya fue usado.</div>`;
                return finDelJuego(true);
            }

            if (comodinElegido === comodinRequerido) {
                comodinesUsados[comodinElegido] = true;
                
                const pistaGanada = preguntasCrimen[pistaIndex];
                pistasCrimen[pistaGanada.clave] = pistaGanada.valor;
                preguntasCrimenRespondidas++;

                document.getElementById('output').innerHTML += `<div style="color: #ffd700; font-weight: bold; margin-top: 15px;">🌟 COMODÍN EXITOSO: ${comodinesMapa[comodinElegido]} corrige la respuesta. ¡La pista **${pistaGanada.clave.toUpperCase().split('(')[0].trim()}** se ha desbloqueado!</div>`;
                mostrarPreguntaCrimen(preguntasCrimenRespondidas);
            } else {
                comodinesUsados[comodinElegido] = true;
                document.getElementById('output').innerHTML += `<div style="color: #ef5350; font-weight: bold; margin-top: 15px;">❌ ERROR FATAL: Elegiste a ${comodinesMapa[comodinElegido]} para un problema incorrecto. ¡Tu ineficiencia económica causó la derrota!</div>`;
                return finDelJuego(true);
            }
        }

        function finDelJuego(fallo) {
            if (fallo) {
                document.getElementById('game-area').innerHTML = `<h1 style="color: #b71c1c;">💥 ¡HAS FALLADO! 💥</h1>
                    <p>La lógica económica se ha roto, la escasez de recursos te ha vencido. No pudiste resolver el misterio.</p>
                    <h2>Has fallado, la economía mundial ha colapsado. 📉</h2>
                    <p>Vuelve a cargar la página para intentar de nuevo.</p>`;
            } else {
                const pistasFinal = Object.entries(pistasCrimen).map(([clave, valor]) => {
                    return `<li><strong>${clave.toUpperCase().split('(')[0].trim()}:</strong> ${valor}</li>`;
                }).join('');
                
                document.getElementById('game-area').innerHTML = `<h1 style="color: #4CAF50;">🎉 ¡CRIMEN RESUELTO! 🎉</h1>
                    <p>¡Has salvado a la disciplina económica! El misterio ha sido revelado:</p>
                    <ul style="text-align: left; list-style-type: disc;">${pistasFinal}</ul>
                    <p><strong>El culpable final es: ${pistasCrimen.ASESINO}</strong></p>
                    <p>¡Misión cumplida!</p>`;
            }
            document.getElementById('status').innerHTML = '';
        }
        
        // --- 5. INICIO DEL JUEGO ---
        document.addEventListener('DOMContentLoaded', () => {
            mostrarHistoria();
        });
    </script>
</body>
</html>
